{% load static %}
{% load compress %}

<!DOCTYPE html>

<html>

    <head>

                <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-EG2SLVG8BT"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-EG2SLVG8BT');
        </script>

        <!-- Yandex.Metrika counter -->
        <script type="text/javascript" >
            (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
            (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        
            ym(96442202, "init", {
                clickmap:true,
                trackLinks:true,
                accurateTrackBounce:true,
                webvisor:true
            });
        </script>
        <noscript><div><img src="https://mc.yandex.ru/watch/96442202" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
        <!-- /Yandex.Metrika counter -->
        
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Мой блокнотик</title>

        <link rel="icon" type="image/x-icon" href="{% static 'logo.png' %}">

        <script src="{% static 'packages/jquery-3.6.1.min.js' %}"></script>
        <script src="{% static 'packages/htmx.min.js' %}"></script>
        <script src="{% static 'packages/iconify.min.js' %}"></script>

        {% compress css %}

            <link rel="stylesheet" href="{% static 'scss/app/home_mobile.scss' %}" type="text/x-scss">

        {% endcompress %}

    </head>
    
    <body>

        <div class="everything">

            <!-- Add note btn -->

            <form idd="newNoteForm">

                <input type="text" name="b" id="newNoteFolder" hidden/>
                <input type="checkbox" name="l" id="lovedSection" hidden/>
                <input type="checkbox" name="a" id="archivedSection" hidden/>

                <button
                    type="submit"
                    hx-post="{% url 'app:create-note-mobile' %}"
                    hx-target=".notes"
                    id="newNoteAllowed"
                    class="add-note-btn">+</button>

                <button
                    type="button"
                    id='newNoteNotAllowed'
                    class="add-note-btn">+</button>

            </form>

            <!-- Profile dropdown btn -->
            <div class="profile-dropdown">

                <div class="buttons">

                    <a href="#">

                        <div class="btn" id="myAccount">

                            <svg style="left: 15px;" xmlns="http://www.w3.org/2000/svg" width="23.339" height="23.34" viewBox="0 0 23.339 23.34">
                                <path id="Icon_ionic-ios-person" data-name="Icon ionic-ios-person" d="M27.828,27.251c-.438-1.933-2.936-2.875-3.8-3.179a28.323,28.323,0,0,0-3.167-.608,3.218,3.218,0,0,1-1.465-.675,12.8,12.8,0,0,1-.1-3,9.016,9.016,0,0,0,.693-1.319,17.013,17.013,0,0,0,.511-2.3s.5,0,.675-.875a8.612,8.612,0,0,0,.45-2.036c-.036-.7-.419-.681-.419-.681a10.657,10.657,0,0,0,.413-3.118c.055-2.5-1.9-4.96-5.446-4.96-3.592,0-5.507,2.462-5.452,4.96a11.116,11.116,0,0,0,.407,3.118s-.383-.018-.419.681a8.612,8.612,0,0,0,.45,2.036c.17.875.675.875.675.875a17.013,17.013,0,0,0,.511,2.3,9.016,9.016,0,0,0,.693,1.319,12.8,12.8,0,0,1-.1,3,3.218,3.218,0,0,1-1.465.675,28.323,28.323,0,0,0-3.167.608c-.863.3-3.361,1.246-3.8,3.179a.486.486,0,0,0,.48.59H27.354A.485.485,0,0,0,27.828,27.251Z" transform="translate(-4.501 -4.5)"/>
                            </svg>
        
                            <span>Мой аккаунт</span>
                        
                        </div>

                    </a>

                    <a href="{% url 'user:logout' %}">

                        <div class="btn" id="logout">

                            <svg style="fill: red;" xmlns="http://www.w3.org/2000/svg" width="28.618" height="27.77" viewBox="0 0 28.618 27.77">
                                <path id="Icon_open-account-logout" data-name="Icon open-account-logout" d="M9.606-1.086c-4,.8-3.2,2.4,0,3.2s9.606-4,12.808,0,3.2,12.007,0,16.01-9.606-.8-12.808,0-4,2.4,0,3.2,12.007,5.6,16.01,0,4-16.81,0-22.414S13.608-1.886,9.606-1.086Zm-3.2,6.4c-1.6.4-6.4,2.4-6.4,4.8s4.8,4.4,6.4,4.8,0-3.2,0-3.2,9.606.8,12.808,0,3.2-2.4,0-3.2S6.4,8.52,6.4,8.52,8,4.918,6.4,5.318Z" transform="translate(0 3.764)"/>
                            </svg>
        
                            <span style="color: red;">Выйти</span>
                        
                        </div>

                    </a>

                </div>

            </div>

            <!-- Account details form -->
            <div class="account-preferences">

                <div class="wrapper">

                    <div id="closeAccountPreferences">×</div>

                    <span class="form-title">Мой аккаунт</span>

                    <div class="fields">

                        <!-- Name -->
                        <div id="profileName" class="field">

                            <svg class='field-icon' id="accountName" xmlns="http://www.w3.org/2000/svg" width="23.339" height="23.34" viewBox="0 0 23.339 23.34">
                                <path id="Icon_ionic-ios-person" data-name="Icon ionic-ios-person" d="M27.828,27.251c-.438-1.933-2.936-2.875-3.8-3.179a28.323,28.323,0,0,0-3.167-.608,3.218,3.218,0,0,1-1.465-.675,12.8,12.8,0,0,1-.1-3,9.016,9.016,0,0,0,.693-1.319,17.013,17.013,0,0,0,.511-2.3s.5,0,.675-.875a8.612,8.612,0,0,0,.45-2.036c-.036-.7-.419-.681-.419-.681a10.657,10.657,0,0,0,.413-3.118c.055-2.5-1.9-4.96-5.446-4.96-3.592,0-5.507,2.462-5.452,4.96a11.116,11.116,0,0,0,.407,3.118s-.383-.018-.419.681a8.612,8.612,0,0,0,.45,2.036c.17.875.675.875.675.875a17.013,17.013,0,0,0,.511,2.3,9.016,9.016,0,0,0,.693,1.319,12.8,12.8,0,0,1-.1,3,3.218,3.218,0,0,1-1.465.675,28.323,28.323,0,0,0-3.167.608c-.863.3-3.361,1.246-3.8,3.179a.486.486,0,0,0,.48.59H27.354A.485.485,0,0,0,27.828,27.251Z" transform="translate(-4.501 -4.5)"/>
                            </svg>

                            <input 
                                type="text"
                                id="profileNameVal"
                                value="{{ profile.name }}"
                                placeholder="Имя" />

                            <svg id="nameError" class="error" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" " role="img" aria-label="Warning Icon "><title>Warning Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.999756C4.13401 0.999756 1 4.13376 1 7.99976C1 11.8657 4.13401 14.9998 8 14.9998C11.866 14.9998 15 11.8657 15 7.99976C15 4.13376 11.866 0.999756 8 0.999756ZM0 7.99976C0 3.58148 3.58172 -0.000244141 8 -0.000244141C12.4183 -0.000244141 16 3.58148 16 7.99976C16 12.418 12.4183 15.9998 8 15.9998C3.58172 15.9998 0 12.418 0 7.99976ZM7.5 8.99951V3.99999H8.5V8.99951H7.5ZM9 11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11C7 10.4477 7.44772 10 8 10C8.55228 10 9 10.4477 9 11Z" fill="currentColor"></path></svg>
                            <svg id="nameOK" class="ok" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" text-carnation" role="img" aria-label="Complete Tick Icon "><title>Complete Tick Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.99854C4.13401 0.99854 1 4.13254 1 7.99854C1 11.8645 4.13401 14.9985 8 14.9985C11.866 14.9985 15 11.8645 15 7.99854C15 4.13254 11.866 0.99854 8 0.99854ZM0 7.99854C0 3.58026 3.58172 -0.00146484 8 -0.00146484C12.4183 -0.00146484 16 3.58026 16 7.99854C16 12.4168 12.4183 15.9985 8 15.9985C3.58172 15.9985 0 12.4168 0 7.99854Z" fill="green"></path><path d="M7.5 10.4985L7.14645 10.8521L7.92183 10.767L7.5 10.4985ZM4.64645 8.35209L7.14645 10.8521L7.85355 10.145L5.35355 7.64498L4.64645 8.35209ZM7.92183 10.767L11.4218 5.26697L10.5782 4.7301L7.07817 10.2301L7.92183 10.767Z" fill="green"></path></svg>

                        </div>

                        <!-- Email -->
                        <div id="profileEmail" class="field">

                            <svg class='field-icon' id="accountEmail" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35" viewBox="0 0 35 35">
                                <defs>
                                  <clipPath id="clip-Пользовательский_размер_1">
                                    <rect width="35" height="35"/>
                                  </clipPath>
                                </defs>
                                <g id="Пользовательский_размер_1" data-name="Пользовательский размер – 1" clip-path="url(#clip-Пользовательский_размер_1)">
                                  <rect width="35" height="35" fill="none"/>
                                  <g id="Icon_feather-mail" data-name="Icon feather-mail" transform="translate(-0.891 0.157)">
                                    <path id="Контур_3" data-name="Контур 3" d="M6.078,6H30.7a3.046,3.046,0,0,1,3.078,2.994V26.958A3.046,3.046,0,0,1,30.7,29.952H6.078A3.046,3.046,0,0,1,3,26.958V8.994A3.046,3.046,0,0,1,6.078,6Z" transform="translate(0)" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
                                    <path id="Контур_4" data-name="Контур 4" d="M33.782,9,18.391,18.973,3,9" transform="translate(0 -0.151)" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
                                  </g>
                                </g>
                            </svg>

                            <input 
                                type="text"
                                id="profileEmailVal"
                                value="{{ user.username }}"
                                placeholder="Почта" />

                            <svg id="emailError" class="error" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" " role="img" aria-label="Warning Icon "><title>Warning Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.999756C4.13401 0.999756 1 4.13376 1 7.99976C1 11.8657 4.13401 14.9998 8 14.9998C11.866 14.9998 15 11.8657 15 7.99976C15 4.13376 11.866 0.999756 8 0.999756ZM0 7.99976C0 3.58148 3.58172 -0.000244141 8 -0.000244141C12.4183 -0.000244141 16 3.58148 16 7.99976C16 12.418 12.4183 15.9998 8 15.9998C3.58172 15.9998 0 12.418 0 7.99976ZM7.5 8.99951V3.99999H8.5V8.99951H7.5ZM9 11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11C7 10.4477 7.44772 10 8 10C8.55228 10 9 10.4477 9 11Z" fill="currentColor"></path></svg>
                            <svg id="emailOK" class="ok" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" text-carnation" role="img" aria-label="Complete Tick Icon "><title>Complete Tick Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.99854C4.13401 0.99854 1 4.13254 1 7.99854C1 11.8645 4.13401 14.9985 8 14.9985C11.866 14.9985 15 11.8645 15 7.99854C15 4.13254 11.866 0.99854 8 0.99854ZM0 7.99854C0 3.58026 3.58172 -0.00146484 8 -0.00146484C12.4183 -0.00146484 16 3.58026 16 7.99854C16 12.4168 12.4183 15.9985 8 15.9985C3.58172 15.9985 0 12.4168 0 7.99854Z" fill="green"></path><path d="M7.5 10.4985L7.14645 10.8521L7.92183 10.767L7.5 10.4985ZM4.64645 8.35209L7.14645 10.8521L7.85355 10.145L5.35355 7.64498L4.64645 8.35209ZM7.92183 10.767L11.4218 5.26697L10.5782 4.7301L7.07817 10.2301L7.92183 10.767Z" fill="green"></path></svg>

                        </div>

                        <!-- Password -->
                        <div id="profilePassword" class="field">

                            <svg class='field-icon' id="accountPassword" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35" viewBox="0 0 35 35">
                                <defs>
                                  <clipPath id="clip-Пользовательский_размер_1">
                                    <rect width="35" height="35"/>
                                  </clipPath>
                                </defs>
                                <g id="Пользовательский_размер_1" data-name="Пользовательский размер – 1" clip-path="url(#clip-Пользовательский_размер_1)">
                                  <rect width="35" height="35" fill="none"/>
                                  <path id="Icon_ionic-ios-lock" data-name="Icon ionic-ios-lock" d="M30.072,15.369h-2v-3.89a8,8,0,1,0-15.992-.108v4h-2A3.341,3.341,0,0,0,6.75,18.7V34.693a3.341,3.341,0,0,0,3.332,3.332h19.99A3.341,3.341,0,0,0,33.4,34.693V18.7A3.341,3.341,0,0,0,30.072,15.369ZM21.243,25.764v5.731a1.194,1.194,0,0,1-1.108,1.2,1.167,1.167,0,0,1-1.224-1.166V25.764a2.665,2.665,0,1,1,2.332,0Zm4.5-10.395H14.413v-4a5.664,5.664,0,0,1,11.328,0Z" transform="translate(-2.577 -3.2)"/>
                                </g>
                            </svg> 

                            <input 
                                type="text"
                                id="profilePasswordVal"
                                placeholder="Новый пароль" />

                            <svg id="passwordError" class="error" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" " role="img" aria-label="Warning Icon "><title>Warning Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.999756C4.13401 0.999756 1 4.13376 1 7.99976C1 11.8657 4.13401 14.9998 8 14.9998C11.866 14.9998 15 11.8657 15 7.99976C15 4.13376 11.866 0.999756 8 0.999756ZM0 7.99976C0 3.58148 3.58172 -0.000244141 8 -0.000244141C12.4183 -0.000244141 16 3.58148 16 7.99976C16 12.418 12.4183 15.9998 8 15.9998C3.58172 15.9998 0 12.418 0 7.99976ZM7.5 8.99951V3.99999H8.5V8.99951H7.5ZM9 11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11C7 10.4477 7.44772 10 8 10C8.55228 10 9 10.4477 9 11Z" fill="currentColor"></path></svg>
                            <svg id="passwordOK" class="ok" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" text-carnation" role="img" aria-label="Complete Tick Icon "><title>Complete Tick Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.99854C4.13401 0.99854 1 4.13254 1 7.99854C1 11.8645 4.13401 14.9985 8 14.9985C11.866 14.9985 15 11.8645 15 7.99854C15 4.13254 11.866 0.99854 8 0.99854ZM0 7.99854C0 3.58026 3.58172 -0.00146484 8 -0.00146484C12.4183 -0.00146484 16 3.58026 16 7.99854C16 12.4168 12.4183 15.9985 8 15.9985C3.58172 15.9985 0 12.4168 0 7.99854Z" fill="green"></path><path d="M7.5 10.4985L7.14645 10.8521L7.92183 10.767L7.5 10.4985ZM4.64645 8.35209L7.14645 10.8521L7.85355 10.145L5.35355 7.64498L4.64645 8.35209ZM7.92183 10.767L11.4218 5.26697L10.5782 4.7301L7.07817 10.2301L7.92183 10.767Z" fill="green"></path></svg>

                        </div>

                    </div>

                </div>

            </div>

            <!-- Create folder form -->
            <div class="create-folder">

                <div class="wrapper">

                    <button id="closeNewFolderForm">×</button>

                    <span class="form-title">Новый блокнот</span>

                    <form>

                        <div id="newFolderTitleWrapper">

                            <input 
                                type="text"
                                name="t"
                                id="newFolderTitle"
                                maxlength="50"
                                placeholder="Заголовок">

                        </div>

                        <button 
                            type="submit" 
                            class="create-folder-btn"
                            hx-post="{% url 'app:create-folder' %}"
                            hx-target=".folders">Создать</button>

                    </form>

                </div>

            </div>
            
            <!-- Edit folder form -->
            <div class="edit-folder">

                <div class="wrapper">

                    <button id="closeEditFolderForm">×</button>

                    <span class="form-title">Редактировать блокнот</span>

                    <div class="form">

                        <div id="editFolderTitleWrapper">

                            <input 
                                type="text"
                                id="editFolderTitle"
                                placeholder="Заголовок">

                        </div>

                        <button 
                            type="submit" 
                            class="edit-folder-btn">Сохранить</button>

                    </div>

                        <!-- htmx deletion form -->
                    <form>

                        <input 
                            type="text"
                            name="f"
                            id="deleteFolderUID"
                            hidden />

                        <button 
                            class="delete-folder-btn"
                            hx-post="{% url 'app:delete-folder' %}"
                            hx-target=".folders">

                            <svg xmlns="http://www.w3.org/2000/svg" width="18.008" height="24.68" viewBox="0 0 18.008 24.68">
                                <g id="Icon_ionic-ios-trash" data-name="Icon ionic-ios-trash" transform="translate(-8.297 -4.5)">
                                <path id="Контур_3" data-name="Контур 3" d="M9.359,9l1.525,20.44a1.981,1.981,0,0,0,1.894,2.06h9.114a1.981,1.981,0,0,0,1.894-2.06L25.292,9ZM13.34,27.633,12.907,11.25h1.2l.446,16.383Zm4.544,0H16.721V11.25h1.164Zm3.381,0h-1.2L20.5,11.25h1.2Z" transform="translate(0 -2.32)"/>
                                <path id="Контур_4" data-name="Контур 4" d="M24.347,6.469H22L20.283,4.852a1.269,1.269,0,0,0-.861-.352H15.193a1.288,1.288,0,0,0-.874.352L12.6,6.469H10.254A1.733,1.733,0,0,0,8.3,8.3H26.3A1.733,1.733,0,0,0,24.347,6.469Z"/>
                                </g>
                            </svg>

                        </button>

                    </form>

                </div>

            </div>

            <!-- Current note photo carousel -->
            <div class="photo-carousel">
                
                <button id="closePhoto">×</button>

                <button id="previousPhoto">

                    <svg xmlns="http://www.w3.org/2000/svg" width="35px" height="35px" viewBox="-4.5 0 19 19" class="cf-icon-svg"><path d="M8.4 17.269a1.026 1.026 0 0 1-.727-.302l-6.801-6.8a1.03 1.03 0 0 1 0-1.456l6.8-6.8a1.03 1.03 0 0 1 1.456 1.455L3.055 9.439l6.073 6.073A1.03 1.03 0 0 1 8.4 17.27z"/></svg>

                </button>
                <button id="nextPhoto">

                    <svg xmlns="http://www.w3.org/2000/svg" transform="scale(-1,-1)" width="35px" height="35px" viewBox="-4.5 0 19 19" class="cf-icon-svg"><path d="M8.4 17.269a1.026 1.026 0 0 1-.727-.302l-6.801-6.8a1.03 1.03 0 0 1 0-1.456l6.8-6.8a1.03 1.03 0 0 1 1.456 1.455L3.055 9.439l6.073 6.073A1.03 1.03 0 0 1 8.4 17.27z"/></svg>

                </button>
            
            </div>

            <!-- Current note -->
            <div class="current-note">

                <div class="wrapper" id="currentNoteWrapper">

                    <div class="top">
                        
                        <button type="button" id="closeCurrentNote">×</button>

                        <div id="currentNoteTitleWrapper">

                            <input type="text" placeholder="Заголовок" class="current-note-title">

                        </div>

                    
                    </div>

                    <div class="photos" id="photosCurrent">

                        {% include 'components/current-note-photos.html' %}

                    </div>

                    <div class="rte">

                        <div class="rte-wrapper">

                            <button id="boldBtnCurrent" style="padding-top: 4px;"><b>Ж</b></button>
                            <button id="italicBtnCurrent" style="padding: 2px 3px 0 0;"><i>К</i></button>
                            <button id="underlineBtnCurrent" style="padding-top: 1px;"><u>С</u></button>
                            <button id="strikeBtnCurrent" style="padding-top: 4px;"><s>О</s></button>
                            
                            <button id="ulBtnCurrent">

                                <svg xmlns="http://www.w3.org/2000/svg" width="23.798" height="18.84" viewBox="0 0 23.798 18.84">
                                    <g id="Icon_ionic-ios-list" data-name="Icon ionic-ios-list" transform="translate(-4.5 -7.313)">
                                    <path id="Контур_1" data-name="Контур 1" d="M7.971,17.767a1.735,1.735,0,1,1-1.735-1.735A1.735,1.735,0,0,1,7.971,17.767Z" transform="translate(0 -1.034)"/>
                                    <path id="Контур_2" data-name="Контур 2" d="M7.971,9.048A1.735,1.735,0,1,1,6.235,7.313,1.735,1.735,0,0,1,7.971,9.048Z"/>
                                    <path id="Контур_3" data-name="Контур 3" d="M7.971,26.485A1.735,1.735,0,1,1,6.235,24.75a1.735,1.735,0,0,1,1.735,1.735Z" transform="translate(0 -2.068)"/>
                                    <path id="Контур_4" data-name="Контур 4" d="M28.236,16.875h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -1.134)"/>
                                    <path id="Контур_5" data-name="Контур 5" d="M28.236,25.594h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -2.168)"/>
                                    <path id="Контур_6" data-name="Контур 6" d="M13.331,10.139h14.9a.992.992,0,0,0,0-1.983h-14.9a.992.992,0,0,0,0,1.983Z" transform="translate(-0.93 -0.1)"/>
                                    </g>
                                </svg>

                            </button>

                            <button id="olBtnCurrent">

                                <svg style="padding-top: 6px;" xmlns="http://www.w3.org/2000/svg" width="23.717" height="25.685" viewBox="0 0 23.717 25.685">
                                    <g id="Icon_ionic-ios-list" data-name="Icon ionic-ios-list" transform="translate(-4.549 -3.733)">
                                    <path id="Контур_1" data-name="Контур 1" d="M6.235,16.031Z" transform="translate(0 -1.034)"/>
                                    <path id="Контур_4" data-name="Контур 4" d="M28.236,16.875h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -1.134)"/>
                                    <path id="Контур_5" data-name="Контур 5" d="M28.236,25.594h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -2.168)"/>
                                    <path id="Контур_6" data-name="Контур 6" d="M13.331,10.139h14.9a.992.992,0,0,0,0-1.983h-14.9a.992.992,0,0,0,0,1.983Z" transform="translate(-0.93 -0.1)"/>
                                    <text id="_2" data-name="2" transform="translate(4.549 27.417)" font-size="8" font-family="SG"><tspan x="0" y="0">3</tspan></text>
                                    <text id="_2-2" data-name="2" transform="translate(4.549 11.733)" font-size="8" font-family="SG"><tspan x="0" y="0">1</tspan></text>
                                    </g>
                                    <text id="_2-3" data-name="2" transform="translate(0 15.842)" font-size="8" font-family="SG"><tspan x="0" y="0">2</tspan></text>
                                </svg>

                            </button>
                            
                            <button id="photoBtnCurrent">

                                <svg style="padding-left: 1px;" xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 24 24" fill="none">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.93334 6.47005C1.93334 3.96453 3.96446 1.93341 6.46998 1.93341H17.5299C20.0354 1.93341 22.0665 3.96453 22.0665 6.47005V8.31337V17.53C22.0665 20.0355 20.0354 22.0666 17.5299 22.0666L8.3133 22.0666L6.46997 22.0666C3.96446 22.0666 1.93334 20.0355 1.93334 17.53V12.0198C1.93303 12.0067 1.93303 11.9935 1.93334 11.9804V6.47005ZM20.3665 6.47005V7.48245C15.4573 7.70571 12.2527 9.86213 10.2708 12.5638C7.97192 10.7456 5.3558 10.6106 3.63334 10.9059V6.47005C3.63334 4.90342 4.90334 3.63341 6.46998 3.63341H17.5299C19.0965 3.63341 20.3665 4.90342 20.3665 6.47005ZM3.63334 17.53V12.636C4.97128 12.3342 7.33257 12.3323 9.35002 14.0066C8.14528 16.1862 7.61609 18.5212 7.49255 20.3666H6.46997C4.90334 20.3666 3.63334 19.0966 3.63334 17.53ZM11.1527 14.2924C9.88823 16.3243 9.33147 18.5993 9.19679 20.3666H17.5299C19.0965 20.3666 20.3665 19.0966 20.3665 17.53V9.18438C15.5975 9.42387 12.7791 11.679 11.1527 14.2924ZM7.85247 8.31337C8.616 8.31337 9.23496 7.69441 9.23496 6.93088C9.23496 6.16735 8.616 5.54839 7.85247 5.54839C7.08894 5.54839 6.46998 6.16735 6.46998 6.93088C6.46998 7.69441 7.08894 8.31337 7.85247 8.31337Z" fill="#1C1C1C"/>
                                </svg>

                            </button>
                            
                            <button id="folderBtnCurrent">

                                <svg style="padding-left: 1px;" xmlns="http://www.w3.org/2000/svg" width="21.364" height="23.313" viewBox="0 0 21.364 23.313">
                                    <g id="Сгруппировать_1" data-name="Сгруппировать 1" transform="translate(-68 461.1)">
                                    <path id="Контур_1" data-name="Контур 1" d="M68-449.349V-437.7h2.444V-461H68Z" transform="translate(0 -0.094)"></path>
                                    <path id="Контур_2" data-name="Контур 2" d="M137-449.443v11.657l7.121-.017,7.116-.017.438-.148a3.994,3.994,0,0,0,2.489-2.307c.29-.767.29-.642.273-9.4-.023-9.156.017-8.36-.455-9.315a3.938,3.938,0,0,0-2.347-1.938c-.392-.131-.449-.131-3.166-.154L145.7-461.1l-.011,4.354-.017,4.359-1.176-.943c-.648-.517-1.193-.943-1.211-.943s-.563.426-1.211.943l-1.176.943-.017-4.353-.011-4.353H137Z" transform="translate(-65.078 0)"></path>
                                    </g>
                                </svg>

                            </button>

                        </div>

                    </div>

                    <!-- Note's folders -->
                    <div class="current-note-folders-form">
                        
                        <div id="closeCurrentNoteFoldersForm">×</div>

                        <div id="folderSearchWrapper">

                            <input 
                                type="text"
                                class="folder-search"
                                placeholder="Название блокнотика"
                                maxlength="50">

                        </div>

                        <span class="folder-title"><b>Блокноты заметки</b></span>

                        <div class="folder-list"></div>

                        <form class="create-new-folder-from-search-current">

                            <input 
                                type="text" 
                                name="t" 
                                id="searchFolderTitle" 
                                hidden />

                            <button
                                id="createFolderInNote"
                                hx-post="{% url 'app:create-folder' %}"
                                hx-target=".folders">Создать</button>

                        </form>

                    </div>
                    
                    <!-- New photo form -->
                    <form 
                        hx-encoding="multipart/form-data"
                        hx-post="{% url 'app:upload-photo-to-note' %}"
                        hx-target="#photosCurrent">
                    
                        <input type="text" name="i" class="current-note-uid" hidden />
                        <input type="file" name="p" id="currentNotePhotoInput" hidden />
                        <button type="submit" id="currentNotePhotoSubmit" style="display: none;"></button>

                    </form>

                    <div class="content">

                        <div contenteditable="true" 
                            class="current-note-content"
                            placeholder="Я помню чудное мгновенье..."></div>

                    </div>

                    <div id="currentNoteContents">{% include 'components/current-note.html' %}</div>

                </div>
                
            </div>

            <!-- TopNav -->
            <div class="topnav">

                <div class="topnav-wrapper">

                    <div class="toggle-sidenav">

                        <div id="toggleSidenavBtn">
    
                            <svg xmlns="http://www.w3.org/2000/svg" width="19.394" height="28.21" viewBox="0 0 19.394 28.21">
                                <path id="Icon_awesome-lightbulb" data-name="Icon awesome-lightbulb" d="M5.293,25.033a1.764,1.764,0,0,0,.3.975l.942,1.415A1.763,1.763,0,0,0,8,28.21h3.4a1.763,1.763,0,0,0,1.468-.787l.942-1.415a1.762,1.762,0,0,0,.3-.975l0-2.113H5.29l0,2.113ZM0,9.7a9.643,9.643,0,0,0,2.4,6.379,15.834,15.834,0,0,1,2.877,5.039c0,.014.006.043.006.043h8.829c0-.014,0-.028.006-.043a15.834,15.834,0,0,1,2.877-5.039A9.7,9.7,0,1,0,0,9.7ZM9.7,5.289A4.413,4.413,0,0,0,5.289,9.7a.882.882,0,0,1-1.763,0A6.178,6.178,0,0,1,9.7,3.526a.882.882,0,0,1,0,1.763Z" transform="translate(0 0)"></path>
                            </svg>
    
                        </div>
    
                    </div>
    
                    <!-- Search form -->
                    <div class="search-notes">
    
                        <div class="search-icon-wrapper">

                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="23.835" height="23.841" viewBox="0 0 23.835 23.841">
                                <path id="Icon_ionic-ios-search" data-name="Icon ionic-ios-search" d="M4.78,26.609l6.629-6.691a9.447,9.447,0,1,1,1.434,1.452L6.257,28.018a1.02,1.02,0,0,1-1.44.037A1.027,1.027,0,0,1,4.78,26.609ZM18.832,21.45a7.46,7.46,0,1,0-5.276-2.185A7.414,7.414,0,0,0,18.832,21.45Z" transform="translate(-4.5 -4.493)"/>
                            </svg>        

                        </div>
                        
                        <form>
    
                            <!-- Folder query -->
                            <input 
                                type="text" 
                                name="f" 
                                class="folderSearch"
                                hidden />
    
                            <!-- Note title/content query -->
                            <div id="noteSearchWrapper">

                                <input 
                                    type="text"
                                    id="noteSearch" 
                                    name="q" 
                                    placeholder="Искать заметку"
                                    hx-post="{% url 'app:search' %}"
                                    hx-target=".notes"
                                    hx-trigger="input changed delay:0.25s">

                            </div>
    
                            <!-- Note section queries -->
    
                                <!-- Loved -->
                            <input 
                                type="checkbox" 
                                name="l" 
                                class="loved-search"
                                hidden />
    
                                <!-- Archived -->
                            <input 
                                type="checkbox" 
                                name="a" 
                                class="archive-search"
                                hidden />
    
                                <!-- Trash search -->
                            <input 
                                type="checkbox" 
                                name="t" 
                                class="trash-search"
                                hidden />
                                
                        </form>
    
                        <form>
    
                            <!-- Folder query -->
                            <input 
                                type="text" 
                                name="f" 
                                class="folderSearch"
                                hidden />
                        
                            <!-- Note section queries -->
    
                                <!-- Loved -->
                            <input 
                                type="checkbox" 
                                name="l" 
                                class="loved-search"
                                hidden />
    
                                <!-- Archived -->
                            <input 
                                type="checkbox" 
                                name="a" 
                                class="archive-search"
                                hidden />
    
                                <!-- Trash search -->
                            <input 
                                type="checkbox" 
                                name="t" 
                                class="trash-search"
                                hidden />
    
                            <button 
                                hx-post="{% url 'app:cancel-search' %}"
                                hx-target=".notes"
                                hx-trigger="click delay:0.5s"
                                id="cancelSearch">×</button>
                        
                        </form>
    
                    </div>
    
                    <!-- Light/dark mode btn -->
                    <div class="mode">
    
                        <label class="toggle-mode">

                            {% if profile.dark_mode %}
                            
                                <input class='toggle-checkbox' id="modeCB" type='checkbox' checked></input>
    
                                <script>
    
                                    $('body').addClass('dark');
    
                                </script>
    
                            {% else %}
    
                                <input class='toggle-checkbox' id="modeCB" type='checkbox'></input>
    
                            {% endif %}

                            <div class='toggle-slot'>
                            <div class='sun-icon-wrapper'>
                                <div class="iconify sun-icon" data-icon="feather-sun" data-inline="false"></div>
                            </div>
                            <div class='toggle-button'></div>
                            <div class='moon-icon-wrapper'>
                                <div class="iconify moon-icon" data-icon="feather-moon" data-inline="false"></div>
                            </div>
                            </div>

                        </label>
    
                    </div>
    
                    <div class="profile">
    
                        <div class="initials">
    
                            <span>{{ profile.initials }}</span>
    
                        </div>
    
                    </div>

                </div>

            </div>

            <!-- SideNav -->
            <div class="sidenav">

                <div 
                    class="page active"
                    id="homeSection"
                    hx-get="{% url 'app:home' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg class="home" xmlns="http://www.w3.org/2000/svg" width="29.174" height="25.726" viewBox="0 0 29.174 25.726">
                            <path id="Icon_material-home" data-name="Icon material-home" d="M14.192,28.373c1.755-2.106-1.4-6.319,0-8.426a3.286,3.286,0,0,1,5.617,0c1.4,2.106-1.755,6.319,0,8.426s5.266,2.809,7.022,0,0-11.234,0-11.234,6.67,3.16,4.213,0S24.023,4.5,17,4.5,5.416,13.979,2.958,17.139s4.213,0,4.213,0-1.755,8.426,0,11.234S12.437,30.48,14.192,28.373Z" transform="translate(-2.414 -4.5)"/>
                        </svg>

                    </div>

                    <span class="page-title">Дом</span>

                </div>

                <div 
                    class="page" 
                    id="lovedSection"
                    hx-get="{% url 'app:loved' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg style="fill: #e31b23; padding-top: 2px;" xmlns="http://www.w3.org/2000/svg" width="24.806" height="21.933" viewBox="0 0 24.806 21.933">
                            <path id="Icon_awesome-heart" data-name="Icon awesome-heart" d="M22.4,3.747a6.576,6.576,0,0,0-9.04.666l-.954.994-.954-.994a6.576,6.576,0,0,0-9.04-.666,7.08,7.08,0,0,0-.48,10.178L11.3,23.707a1.508,1.508,0,0,0,2.195,0l9.375-9.781A7.076,7.076,0,0,0,22.4,3.747Z" transform="translate(0.001 -2.248)"/>
                        </svg>

                    </div>

                    <span class="page-title" style="color: #e31b23;">Любимое</span>

                </div>

                <div class="page" id="newFolderInit">

                    <div class="icon">

                        <span>+</span>

                    </div>

                    <span class="page-title">Новый блокнот</span>

                </div>

                <div class="folders">{% include 'components/folders.html' %}</div>

                <div 
                    class="page"
                    id="archiveSection"
                    hx-get="{% url 'app:archive' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg xmlns="http://www.w3.org/2000/svg" width="25.015" height="22.657" viewBox="0 0 25.015 22.657">
                            <g id="Icon_ionic-ios-archive" data-name="Icon ionic-ios-archive" transform="translate(-3.375 -4.5)">
                            <path id="Контур_1" data-name="Контур 1" d="M28.149,7.761H3.616a.238.238,0,0,1-.241-.233V6.363A1.892,1.892,0,0,1,5.3,4.5H26.465A1.892,1.892,0,0,1,28.39,6.363V7.528A.238.238,0,0,1,28.149,7.761Z"/>
                            <path id="Контур_2" data-name="Контур 2" d="M27.169,10.266H4.982a.476.476,0,0,0-.482.466V25.988a1.9,1.9,0,0,0,1.929,1.863H25.722a1.9,1.9,0,0,0,1.929-1.863V10.731A.476.476,0,0,0,27.169,10.266ZM19.09,18.534h-6a.856.856,0,0,1-.862-.716.826.826,0,0,1,.838-.914h6a.856.856,0,0,1,.862.716A.829.829,0,0,1,19.09,18.534Z" transform="translate(-0.193 -0.694)"/>
                            </g>
                        </svg>

                    </div>

                    <span class="page-title">Архив</span>

                </div>

                <div 
                    class="page"
                    id="trashSection"
                    hx-get="{% url 'app:trash' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg xmlns="http://www.w3.org/2000/svg" width="18.008" height="24.68" viewBox="0 0 18.008 24.68">
                            <g id="Icon_ionic-ios-trash" data-name="Icon ionic-ios-trash" transform="translate(-8.297 -4.5)">
                            <path id="Контур_3" data-name="Контур 3" d="M9.359,9l1.525,20.44a1.981,1.981,0,0,0,1.894,2.06h9.114a1.981,1.981,0,0,0,1.894-2.06L25.292,9ZM13.34,27.633,12.907,11.25h1.2l.446,16.383Zm4.544,0H16.721V11.25h1.164Zm3.381,0h-1.2L20.5,11.25h1.2Z" transform="translate(0 -2.32)"/>
                            <path id="Контур_4" data-name="Контур 4" d="M24.347,6.469H22L20.283,4.852a1.269,1.269,0,0,0-.861-.352H15.193a1.288,1.288,0,0,0-.874.352L12.6,6.469H10.254A1.733,1.733,0,0,0,8.3,8.3H26.3A1.733,1.733,0,0,0,24.347,6.469Z"/>
                            </g>
                        </svg>

                    </div>

                    <span class="page-title">Корзина</span>

                </div>

            </div>
            
            <!-- Notes -->
            <div class="notes">

                {% include 'components/notes.html' %}

                <div class="first-note">

                    <span class="warn-text">Зафиксируй мгновение 💡</span>
                    <span class="cta-text">Создай первую заметку ✍</span>
                    <button 
                        type="submit"
                        class="cta-btn"
                        hx-post="{% url 'app:create-first-note' %}"
                        hx-target=".notes">Создать заметку</button>

                </div>

            </div>

        </div>

    </body>

    <script>

        

    </script>

    <style>

        @font-face {

            font-family: Comfortaa;
            src: url("{% static 'fonts/Comfortaa.ttf' %}");

        }

        @font-face {

            font-family: SG;
            src: url("{% static 'fonts/ShowcardGothic.otf' %}");
        
        }

    </style>

    <!-- universal -->
    <script>

        document.body.addEventListener('htmx:configRequest', (event) => {

            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';

        });

        function delay(callback, ms) {

            var timer = 0;

            return function() {

                var context = this, args = arguments;
                clearTimeout(timer);
                
                timer = setTimeout(function () {

                    callback.apply(context, args);

                }, ms || 0);

            };
            
        };

        function validateEmail(e) {

            var re = /\S+@\S+\.\S+/;
            return re.test(e);

        }

        function hasNumber(myString) {

            return /\d/.test(myString);
        
        }

    </script>

    <!-- Search -->

    <script>

        $('.search-icon-wrapper').click(function() {

            $('#noteSearchWrapper').show();

            $('.search-icon-wrapper').css({

                'top': -60,
                'left': 5,
                'box-shadow': 'none',

            });

            $('#cancelSearch').show();
            $('#cancelSearch').css('opacity', 1);

            
        });
        
        $('#cancelSearch').click(function() {
            
            $('#noteSearchWrapper').hide();

            $('.search-icon-wrapper').css({

                'top': -63,
                'left': 90,
                'box-shadow': '3px 3px 8px #d8cec4, -3px -3px 8px #fffffa',

            });

        });

    </script>

    <!-- Sidenav close on page click -->
    <script>

        $('.page').click(function() {

            toggleSidenav();
            $('#toggleSidenavBtn').removeClass('active');
            
        });

    </script>

    <!-- First note cta -->

    <script>

        if ($('.note-section').children('.note').length == 0) {

            $('.first-note').css('display', 'flex');
            $('.note-section-title').hide();

        };
        
        $('.cta-btn').click(function() {

            $('.first-note').hide();

            $('.current-note').show();
            $('.current-note').animate({

                'opacity': 1,

            }, 250);

        });

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementsByClassName('notes')[0]) {

                newNoteUID = $('#otherNotes').children(':first-child').children('.note-actions').children('#noteUID').val();

                $('.current-note-uid').val(newNoteUID);

            }
    
        });

    </script>

    <!-- Mode -->
    <script>

        $('#modeCB').change(function() {

            $('body').toggleClass('dark')

            $.ajax({

                type: 'POST',

                url: "{% url 'user:toggle-mode' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                }

            });

        });

    </script>

    <!-- Profile -->
    <script>

        /* Dropdown */

        profileDropdownOpen = false;
        
        $('.profile').click(function() {

            $('.initials').toggleClass('active');

            if (profileDropdownOpen) {

                $('.profile-dropdown').animate({'opacity': 0}, 250);

                setTimeout(function() {

                    $('.profile-dropdown').hide();

                }, 250);

                profileDropdownOpen = false;

            } else {

                $('.profile-dropdown').show();
                $('.profile-dropdown').animate({'opacity': 1}, 250);

                profileDropdownOpen = true;

            }

        });

        /* Button & dropdown animation */

        $('#myAccount, #logout').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.btn').removeClass('active');

            }, 250);

                /* Hide profile dropdown */
            $('.initials').removeClass('active');

            $('.profile-dropdown').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.profile-dropdown').hide();

            }, 250);

            profileDropdownOpen = false;

        });

        /* Account preferences */

        accountFormOpen = false;

            /* Form render */
        $('#myAccount').click(function() {

            accountFormOpen = true;

            $('.account-preferences').css('display', 'flex');
            $('.account-preferences').animate({

                'opacity': 1,

            }, 250);

            oldName = $('#profileNameVal').val();
            oldEmail = $('#profileEmailVal').val();

        });

            /* Close form */
        $('#closeAccountPreferences').click(function() {

            accountFormOpen = false;

            $('#closeAccountPreferences').addClass('active');

            $('.account-preferences').animate({

                'opacity': 0,

            }, 250);

            setTimeout(function() {

                $('#closeAccountPreferences').removeClass('active');

                $('.account-preferences').hide();

                $('#emailError').hide();
                $('#nameError').hide();
                $('#passwordError').hide();
                $('#profilePasswordVal').val('');

            }, 250);

        });

            /* Field logic */

        /* Name */
        document.getElementById('profileNameVal').addEventListener('input', function() {

            $('#nameError').hide();
            $('#nameOK').hide();

        });

        document.getElementById('profileNameVal').addEventListener('input', delay(function() {

            if (!$('#profileNameVal').val()) {

                $('#nameError').show();

            } else {

                $('#nameOK').show();

                setTimeout(function() {

                    $('#nameOK').hide();

                }, 1500);

                newName = $('#profileNameVal').val();

                if (newName != oldName) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'user:cn' %}",

                        data: {

                            'csrfmiddlewaretoken': "{{ csrf_token }}",
                            'n': newName,

                        }

                    });

                }

            }
            
        }, 750));

        /* Email */
        document.getElementById('profileEmailVal').addEventListener('input', function() {

            $('#emailError').hide();
            $('#emailOK').hide();

        });

        document.getElementById('profileEmailVal').addEventListener('input', delay(function() {

            newEmail = $('#profileEmailVal').val();

            if (!validateEmail(newEmail)) {

                $('#emailError').show();

            } else {

                $('#emailOK').show();

                setTimeout(function() {

                    $('#emailOK').hide();

                }, 1500);

                if (newEmail != oldEmail) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'user:cu' %}",

                        data: {

                            'csrfmiddlewaretoken': "{{ csrf_token }}",
                            'e': newEmail,

                        }

                    });

                }

            }
            
        }, 750));

        /* Password */

        document.getElementById('profilePasswordVal').addEventListener('input', function() {

            $('#passwordError').hide();
            $('#passwordOK').hide();

        });

        document.getElementById('profilePasswordVal').addEventListener('input', delay(function() {

            newPassword = $('#profilePasswordVal').val();

            if (newPassword.length < 7 || !hasNumber(newPassword)) {

                $('#passwordError').show();

            } else {
                
                $('#passwordOK').show();

                setTimeout(function() {

                    $('#passwordOK').hide();

                }, 1500);


                $.ajax({

                    type: 'POST',

                    url: "{% url 'user:cp' %}",

                    data: {

                        'csrfmiddlewaretoken': "{{ csrf_token }}",
                        'p': newPassword,

                    }

                });

            }
            
        }, 750));

    </script>
    
    <!-- Sidenav -->
    <script>

        sidenavOpen = false;

        function toggleSidenav() {

            if ($('.sidenav').hasClass('open')) {

                $('.sidenav').removeClass('open');

                $('.page-title').hide();
                $('.page-title').css('opacity', 0);

                $('.edit-folder-btn-init').hide();
                $('.edit-folder-btn-init').css('opacity', 0);
                
            } else {

                $('.sidenav').addClass('open');

                $('.page-title').show();
                $('.page-title').animate({'opacity': 1}, 750);

                setTimeout(function() {

                    $('.edit-folder-btn-init').css('display', 'flex');

                    $('.edit-folder-btn-init').animate({

                        'opacity': 1,

                    }, 250);

                }, 500);

            }

        }

        $('#toggleSidenavBtn').click(function() {

            $(this).toggleClass('active');

            toggleSidenav();
            
            sidenavOpen = !sidenavOpen;

        });

        $('body').on('click', '#homeSection, #lovedSection, #folderSection, #archiveSection, #trashSection', function(e) {
        
            $('.page').removeClass('active');
            $(this).addClass('active');

            $('.notes').animate({'opacity': 0}, 500);

            setTimeout(function() {

                $('.notes').animate({'opacity': 1}, 500);

            });

        });

        $('body').on('click', '#newFolderInit', function() {

            $('#newFolderInit').addClass('active');

            setTimeout(function() {

                $('#newFolderInit').removeClass('active');

            }, 250);

        });

        
        /* Edit folder */

        editFolderFormShown = false;

        $('body').on('click', '.edit-folder-btn-init', function() {

            editFolderFormShown = true;

            editFolderBtn = $(this);

            editFolderBtn.addClass('active');

            setTimeout(function() {

                editFolderBtn.removeClass('active');

            }, 250);
 
            editingFolderUID = $(this).siblings('#folderUID').val();
            previousTitle = $(this).siblings('.page-title').children('span').text();

            $('#editFolderTitle').val(previousTitle);
            $('#deleteFolderUID').val(editingFolderUID);

            $('.edit-folder').css('display', 'flex');
            $('.edit-folder').animate({'opacity': 1}, 250);

        });

            /* Folder title checks (emptiness) & (uniqueness) */

        document.getElementById('editFolderTitle').addEventListener('input', function() {
        
            if ($(this).val().trim().length === 0) {

                $('.edit-folder-btn').prop('disabled', true);

            } else {

                newTitle = $(this).val();

                titleUnique = true;

                $('.folders').children('.page').each(function() {

                    title = $(this).children('.page-title').children('span').text();
                        
                    if (title == newTitle) {

                        titleUnique = false;

                    }

                });
                
                if (titleUnique) {

                    $('.edit-folder-btn').prop('disabled', false);

                } else {

                    $('.edit-folder-btn').prop('disabled', true);

                }        

            }

        }, false);

            /* Close form */
        $('#closeEditFolderForm, .edit-folder-btn, .delete-folder-btn').click(function() { 

            editFolderFormShown = false;

            $('.edit-folder-btn-init').removeClass('active');

            $('.edit-folder').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.edit-folder').css('display', 'none');

            }, 250);

        });

        $('#closeEditFolderForm').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('#closeEditFolderForm').removeClass('active');

            }, 250);

        });

        $('.edit-folder-btn-init').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.edit-folder-btn-init').removeClass('active');

            }, 250);

        });

        $('.delete-folder-btn').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.delete-folder-btn').removeClass('active');

            }, 250);

        });
        
            /* Redirect to home section if folder has been deleted */
        $('.delete-folder-btn').click(function() {

            document.getElementById('homeSection').click();

        });

            /* Update folder title */
        $('.edit-folder-btn').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.edit-folder-btn').removeClass('active');

            }, 250)

            $('.folders').children('.page').each(function() {

                if ($(this).children('#folderUID').val() == editingFolderUID) {

                    $(this).children('.page-title').children('span').text($('#editFolderTitle').val());

                }

            });

            $('.note-section-title').text($('#editFolderTitle').val());

            /* Submit ajax request only if the title has changed */

            if ($('#editFolderTitle').val() != previousTitle) {

                $.ajax({

                    type: 'POST',

                    url: "{% url 'app:edit-folder' %}",

                    data: {

                        'csrfmiddlewaretoken': "{{ csrf_token }}",
                        'u': editingFolderUID,
                        't': $('#editFolderTitle').val(),

                    }

                });

            }

        });

        /* Icon bug */

        setInterval(function() {

            if ($('.page').width() == '55') {

                $('.edit-folder-btn-init').hide();

                $('.page-title').css('opacity', 0);

            }

        }, 10);

    </script>

    <!-- Pop-ups -->

    <!-- Search notes -->
    <script>

        /* Change placeholder depending on device width */

        if ($(window).width() <= 775) {

            $('#noteSearch').attr('placeholder', 'Искать');

        } else {

            $('#noteSearch').attr('placeholder', 'Искать заметку');

        }

        $(window).resize(function() {

            if ($(window).width() <= 775) {

                $('#noteSearch').attr('placeholder', 'Искать');

            } else {

                $('#noteSearch').attr('placeholder', 'Искать заметку');

            }

        });

        document.getElementById('noteSearch').addEventListener('input', function() {

            $('#cancelSearch').css('display', 'flex');
            $('#cancelSearch').animate({'opacity': 1}, 250);

        }, false);

        $('body').on('click', '#cancelSearch', function() {

            $('#noteSearch').val('');
            $(this).animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('#cancelSearch').hide();

            }, 250)   

        });

    </script>
    
    <script>

        $('#newNoteAllowed').click(function() {

            $('.current-note').show();

            $('.current-note').animate({

                'opacity': 1,

            }, 250);

        });

        /* Get UID of newly added note and paste it to current note props */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementsByClassName('notes')[0]) {

                newNote = $('#otherNotes').children('.note').first();

                newUID = newNote.children('.note-actions').children('#noteUID').val();

                $('.current-note-uid').val(newUID);
                $('#currentNoteUID').val(newUID);

            }

        });

    </script>


    <!-- Folders -->
    <script>

        /* Creation */

        folderFormShown = false;

            /* Form show */

        $('#newFolderInit').click(function() {

            folderFormShown = true;

            $('#newFolderTitle').val('');
            $('.create-folder-btn').prop('disabled', true);

            $('.create-folder').css('display', 'flex');
            $('.create-folder').animate({'opacity': 1}, 250);

        });

            /* Form hide */

        $('#closeNewFolderForm, .create-folder-btn').click(function() {

            folderFormShown = false;

            $('.create-folder').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.create-folder').css('display', 'none');

            }, 250);

        });

            /* Close new folder form */    
        $('#closeNewFolderForm').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('#closeNewFolderForm').removeClass('active');

            }, 250);

        });

            /* Create folder btn */
        $('.create-folder-btn').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.create-folder-btn').removeClass('active');

            }, 250);

        });

            /* Close new folder form */
        $('#closeNewFolderForm').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('#closeNewFolderForm').removeClass('active');

            }, 250);

        });

            /* Go to folder once folder is created */
        document.body.addEventListener('htmx:afterSwap', function(e) {

            if (e.detail.target === document.getElementsByClassName('folders')[0]) {

                $('.folders').children('.page').each(function() {

                    if ($(this).children('.page-title').children('span').text() === newTitle) {
                        
                        $(this).click();

                        uid = $(this).children('#folderUID').val();
                        $('#currentFolder').val(uid);
                        
                        $('.note-section-title').text(newTitle);
                        $('.note-section').hide();

                    }

                });

            }

        });

            /* Folder title checks (emptiness) & (uniqueness) */
        document.getElementById('newFolderTitle').addEventListener('input', function() {
            
            if ($(this).val().trim().length === 0) {

                $('.create-folder-btn').prop('disabled', true);

            } else {

                newTitle = $(this).val();

                titleUnique = true;

                $('.folders').children('.page').each(function() {

                    title = $(this).children('.page-title').children('span').text();
                        
                    if (title == newTitle) {

                        titleUnique = false;

                    }

                });
                
                if (titleUnique) {

                    $('.create-folder-btn').prop('disabled', false);

                } else {

                    $('.create-folder-btn').prop('disabled', true);

                }        

            }

        }, false);

    </script>

    <!-- Current note -->
    <script>

        noteOpen = false;

        /* Before window is closed */

        window.onbeforeunload = function() {

            if (noteChanged) {

                return 'Не уходите! Ваша заметка сохраняется c:';

            }

        }

        window.onunload = function() {

            if (noteChanged) {

                return 'Не уходите! Ваша заметка сохраняется.';

            }

        }

        /* On note load */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementById('currentNoteContents')) {

                /* Paste data from GET request */

                    /* Text */
                $('.current-note-uid').val($('#currentNoteUID').val());
                $('.current-note-title').val($('#currentNoteTitle').val());
                $('.current-note-content').html($('#currentNoteContent').val());


                    /* Photos */
                if ($('#currentNotePhotos').children().length > 0) {

                    $('#photosCurrent').css('display', 'block');

                    $('#currentNotePhotos').children('.photo').each(function() {

                        $('#photosCurrent').append($(this));

                    });

                }

                    /* Folders  */
                noteFolders = [];
                
                if ($('#currentNoteFolders').children('.folder').length === 0) {

                    $('.current-note-folders').hide();

                } else {

                    $('.current-note-folders').show();

                    $('#currentNoteFolders').children('.folder').each(function() {

                        noteFolders.push($(this).children('input').val());
                        $(this).appendTo('.current-note-folders');

                    });

                }

                $('body').css('overflow', 'hidden');
                
                    /* Render the note */
                $('#currentNoteContents').hide();

                $('.current-note').css('display', 'flex');
                $('.current-note').animate({'opacity': 1}, 500);

                noteOpen = true;
                photoOpen = false;

            }
    
        });

        /* Autosave */

        var delay = (function(){
            var timer = 0;
            return function(callback, ms){
                clearTimeout (timer);
                timer = setTimeout(callback, ms);
            };
        })();

            /* Title */
        document.getElementsByClassName('current-note-title')[0].addEventListener('input', function() {

            title = $('.current-note-title').val();
            noteUID = $('.current-note-uid').val();

            noteChanged = true;

            delay(function() {

                if (noteOpen) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'app:update-title' %}",

                        data: {

                            'csrfmiddlewaretoken': '{{ csrf_token }}',

                            't': title,
                            'u': noteUID,

                        }

                    });

                    noteChanged = false;

                }

            }, 2000);

            $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                    $(this).children('.text').children('.title').text(title);

                }

            });

        }, false);

            /* Content */

        document.getElementsByClassName('current-note-content')[0].addEventListener('input', function() {

            content = $('.current-note-content').html();
            noteUID = $('.current-note-uid').val();

            noteChanged = true;

            delay(function() {

                if (noteOpen) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'app:update-content' %}",

                        data: {

                            'csrfmiddlewaretoken': '{{ csrf_token }}',

                            'c': content,
                            'u': noteUID,

                        }

                    });

                    noteChanged = false;

                }

            }, 2000);

            $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                    $(this).children('.text').children('.content').html(content);

                }

            });

        }, false);

        /* Photos */

            /* Trash icon on hover */

        $('body').on('mouseover', '.photo', function() {

            $(this).children('#removePhoto').animate({'opacity': 1}, 250);

        });
        
        $('body').on('mouseleave', '.photo', function() {

            $(this).children('#removePhoto').animate({'opacity': 0}, 250);

        });

            /* Display photos div on upload */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementById('photosCurrent')) {

                $('#photosCurrent').show();

            }
    
        });

            /* Full reso on click */

        $('body').on('click', '.photo', function(e) {

            if ($(e.target).is('img')) {

                openedPhoto = $(this).children('img').clone();
                previousPhotos = $(this).prevAll();
                nextPhotos = $(this).nextAll();

                if (previousPhotos.length > 0) {$('#previousPhoto').show();}
                if (nextPhotos.length > 0) {$('#nextPhoto').show();}
                
                previousPhotos.each(function() {
                    
                    photo = $(this).children('img').clone();
                    photo.css('display', 'none');
                    photo.appendTo('.photo-carousel');
                    
                });
                
                openedPhoto.attr('id', 'currentPhoto');
                openedPhoto.appendTo('.photo-carousel');

                nextPhotos.each(function() {

                    photo = $(this).children('img').clone();
                    photo.css('display', 'none');
                    photo.appendTo('.photo-carousel');

                });

                $('.photo-carousel').css('display', 'flex');
                $('.photo-carousel').animate({'opacity': 1}, 250);

                photoOpen = true;
                
            }

        });

            /* Next & Previous photos logic */
        $('body').on('click', '#nextPhoto', function() {

            nextPhoto = $('#currentPhoto').next();

            nextPhoto.css('display', 'block');
            $('#currentPhoto').hide();

            $('#currentPhoto').attr('id', '');
            nextPhoto.attr('id', 'currentPhoto');

            $('#previousPhoto').show();

            if (nextPhoto.nextAll().length === 0) {$('#nextPhoto').hide();}

        });

        $('body').on('click', '#previousPhoto', function() {

            previousPhoto = $('#currentPhoto').prev();

            previousPhoto.css('display', 'block');
            $('#currentPhoto').hide();

            $('#currentPhoto').attr('id', '');
            previousPhoto.attr('id', 'currentPhoto');

            $('#nextPhoto').show();

            if (previousPhoto.prevUntil('button').length === 0) {$('#previousPhoto').hide();}

        });

            /* Close full reso on btn click/esc */

        function closePhotoCarousel() {

            $('.photo-carousel').animate({'opacity': 0}, 250);
            
            setTimeout(function() {

                $('#nextPhoto').hide();
                $('#previousPhoto').hide();

                $('.photo-carousel').hide();
                $('.photo-carousel').children('img').each(function(){$(this).remove();})

            }, 250);

            photoOpen = false;

        }

        $('body').on('click', '#closePhoto', function() {

            closePhotoCarousel();

        });

            /* Delete */

        $('body').on('click', '#removePhoto', function() {

            photoToRemove = $(this).parent();

            photoToRemove.animate({opacity: 0}, 500);

            setTimeout(function() {

                photoToRemove.remove();

                if ($('#photosCurrent').children().length === 0) {

                    $('#photosCurrent').hide();

                }

            }, 500);

            $.ajax({

                type: 'POST',

                url: "{% url 'app:delete-photo' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    
                    'n': $('.current-note-uid').val(),
                    'p': $(this).siblings('input').val(),

                },

            });

        });

        /* Remove folders at footer */

        $('body').on('mouseover', '.folder', function() {

            $(this).children('#removeFolder').animate({'opacity': 1}, 250);

        });

        $('body').on('mouseleave', '.folder', function() {

            $(this).children('#removeFolder').animate({'opacity': 0}, 250);

        });

        $('body').on('click', '#removeFolder', function() {

            $(this).addClass('active');

            uid = $(this).siblings('#folderUID').val();
            folderTitle = $(this).siblings('span').text();

            noteFolders.pop(uid);
            folderSearchInit();

            folder = $(this).parent();
            folder.animate({'opacity': 0}, 250);

            setTimeout(function() {
                
                folder.remove();

                if ($('.current-note-folders').children('.folder').length === 0) {

                    $('.current-note-folders').hide();

                }
            
            }, 250);

            $.ajax({

                type: 'POST',

                url: "{% url 'app:remove-folder' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                    'f': $(this).siblings('#folderUID').val(),
                    'n': $('.current-note-uid').val(),

                }

            });

            $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                if ($(this).children('.note-actions').children('#noteUID').val() == $('.current-note-uid').val()) {

                    $(this).children('.folders').children('.folder').each(function() {
                        
                        if ($(this).children('.folder-title').text() == folderTitle) {

                            $(this).remove();

                        }

                    });

                    if ($(this).children('.folders').children('.folder').length === 0) {

                        $(this).children('.folders').remove();

                    }

                }

            });

        });

        /* Note folders search */

            /* init */
        folderSearchOpen = false;
        noteFolders = [];

        function folderSearchInit() {

            $('.folder-list').html('');

            $('.folders').children('.page').each(function() {

                uid = $(this).children('#folderUID').val();
                title = $(this).children('.page-title').children('span').text();
                    
                if (!noteFolders.includes(uid) && uid != '') {
                                                                
                    $('.folder-list').append(

                        `

                            <div id='noteFolder'>

                                <input type='text' value='` + uid + `'/>
                                <span class='title'>` + title + `</span>

                            </div>

                        `

                    );

                } else if (noteFolders.includes(uid)) {

                    $('.folder-list').prepend(

                        `

                            <div id='noteFolder' class='inNote'>

                                <input type='text' value='` + uid + `'/>
                                <span class='title'>` + title + ` </span>

                            </div>

                        `

                    );

                }

            });

            if ($('.folder-list').children('#noteFolder').length == 0) {
                
                $('.folder-list').hide();
                
            } else if ($('.folder-list').children('#noteFolder').length == 1) {
                    
                $('#noteFolder:last-child').css('margin', 0);
                $('#createFolderInNoteNew').css('top', 70);
                    
            } else {
                
                $('#noteFolder').css('marginBottom', 15);
                $('#noteFolder:last-child').css('margin', 0);
                $('#createFolderInNoteNew').css('top', 70);

            }

        }

        $('body').on('click', '#noteFolder', function() {

            noteUID = $('.current-note-uid').val();

            folderUID = $(this).children('input').val();
            folderTitle = $(this).children('span').text();

            if (!$(this).hasClass('inNote')) {

                $(this).addClass('inNote');

                $('.current-note-folders').show();

                $('.current-note-folders').append(

                    `

                        <div class='folder'>

                            <input
                                type='text'
                                value='` + folderUID + `'
                                hidden />

                            <span>` + folderTitle + `</span>
                            <button id='removeFolder'>×</button

                        </div>

                    `

                );

                noteFolders.push(folderUID);

                $.ajax({

                    type: 'POST',

                    url: "{% url 'app:add-folder' %}",

                    data: {

                        'csrfmiddlewaretoken': '{{ csrf_token }}',

                        'f': folderUID,
                        'n': $('.current-note-uid').val(),

                    }
                    
                });

                /* Add folder to note in note list */
                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                        if ($(this).children('.folders').length === 0) {

                            $(this).append(

                                `
                                    <div 
                                        class='folders'
                                        hx-get="/get-note/` + noteUID + `/"
                                        hx-target="#currentNoteContents"></div>

                                `

                            )

                        }

                        $(this).children('.folders').append(

                            `
                                <div class='folder'>
                                    <span class='folder-title'>` + folderTitle + `</span>
                                </div>
                            `

                        )

                    }

                });

            } else {

                $(this).removeClass('inNote');

                $('.current-note-folders').children('.folder').each(function() {

                    if (folderUID == $(this).children('input').val()){$(this).remove();}

                });

                noteFolders.pop(folderUID);

                $.ajax({

                    type: 'POST',

                    url: "{% url 'app:remove-folder' %}",

                    data: {

                        'csrfmiddlewaretoken': '{{ csrf_token }}',

                        'f': folderUID,
                        'n': $('.current-note-uid').val(),

                    }
                    
                });

                if ($('.current-note-folders').children('.folder').length === 0) {

                    $('.current-note-folders').hide();

                }

                /* Remove folder from note in note list */
                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == $('.current-note-uid').val()) {

                        $(this).children('.folders').children('.folder').each(function() {
                            
                            if ($(this).children('.folder-title').text() == folderTitle) {

                                $(this).remove();

                            }

                        });

                        if ($(this).children('.folders').children('.folder').length === 0) {

                            $(this).children('.folders').remove();

                        }

                    }

                });

                /* Remove note from note list if the folder removed is the current folder */
                if (clickedFolderTitle == $('.note-section-title').text()) {

                    currentNoteUID = $('.current-note-uid').val();

                    $('.notes').children('.wrapper').children('.note-section').each('.note').each(function() {

                        noteInstanceUID = $(this).children('.note-actions').children('#noteUID').val();

                        if (currentNoteUID == noteInstanceUID) {

                            $(this).remove();

                        }

                    })

                }

            }

        });

            /* Form render */

        $('#folderBtnCurrent').click(function() {

            if (!folderSearchOpen) {

                $('.current-note-folders-form').css('display', 'block');
                $('.current-note-folders-form').animate({'opacity': 1}, 250);

                folderSearchInit();

                folderSearchOpen = true;

                $(this).addClass('active');

            } else {

                closeFolderSearch();

                $(this).removeClass('active');
                
            }

        });

        $('#closeCurrentNoteFoldersForm').click(function() {

            closeFolderSearch();

            $(this).addClass('active');

            setTimeout(function() {

                $('#closeCurrentNoteFoldersForm').removeClass('active');

            }, 250);

        });

            /* Form remove */

        function closeFolderSearch() {

            $('.current-note-folders-form').animate({'opacity': 0}, 250);

            setTimeout(function() {
                
                $('.current-note-folders-form').css('display', 'none');

                $('.folder-search').val('');
                $('#searchFolderTitle').val('');
                $('.create-new-folder-from-search').hide();
                $('.folder-list').html('');


            }, 250);

            folderSearchOpen = false;

            $('#folderBtnCurrent').removeClass('active');

        }

            /* Search */

        $('.folder-search').on('input', function() {

            folderExists = false;

            $('#searchFolderTitle').val($(this).val());

            $('.folder-list').html('');

            $('.folder-list').show();

            if ($(this).val().trim().length === 0) {

                $('.create-new-folder-from-search-current').hide();

                folderSearchInit();

            } else {

                query = $(this).val();

                $('.folders').children('.page').each(function() {

                    uid = $(this).children('#folderUID').val();
                    title = $(this).children('.page-title').children('span').text().toString();

                    if (title === query) { /* Folder exists */

                        folderExists = true;

                    }

                    if (~title.indexOf(query)) {

                        if (noteFolders.includes(uid)) {

                            $('.folder-list').prepend(

                                `

                                    <div id='noteFolder' class='inNote'>

                                        <input type='text' value='` + uid + `' hidden />
                                        <span>` + title + ` </span>

                                    </div>

                                `

                            );

                        } else {

                            $('.folder-list').prepend(

                                `

                                    <div id='noteFolder'>

                                        <input type='text' value='` + uid + `' hidden />
                                        <span>` + title + ` </span>

                                    </div>

                                `

                            );

                        }

                    }

                });

                if (folderExists) {

                    $('.create-new-folder-from-search-current').hide();
                
                } else {

                    $('#createFolderInNote').text("Создать '" + query + "'");
                    $('.create-new-folder-from-search-current').show();

                }

                if ($('.folder-list').children('#noteFolder').length == 0) {
                    
                    $('.folder-list').hide();
                
                } else if ($('.folder-list').children('#noteFolder').length == 1) {

                    $('#noteFolder').css('margin', 0);

                } else {

                    $('#noteFolder').css('marginBottom', 15);
                    $('#noteFolder:last-child').css('margin', 0);
                    $('#createFolderInNoteNew').css('top', 70);

                }

            }

        });

            /* Sidenav folder opacity if open */
        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target == document.getElementsByClassName('folders')[0]) {

                if ($('.sidenav').hasClass('open')) {

                    $('.page-title').css('opacity', 1);

                }

            }

        })

            /* Creating folder from folder search (current note) */
        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target == document.getElementsByClassName('folders')[0] && noteOpen) {

                title = $('#searchFolderTitle').val();

                $('.folders').children('.page').each(function() {

                    if ($(this).children('.page-title').children('span').text() === title) {
                        
                        uid = $(this).children('#folderUID').val();

                        $('.current-note-folders').append(

                            `

                                <div class='folder'>

                                    <input
                                        type='text'
                                        value='` + uid + `'
                                        hidden />

                                    <span>` + title + `</span>
                                    <button id='removeFolder'>×</button

                                </div>

                            `

                        );

                        $.ajax({

                            type: 'POST',

                            url: "{% url 'app:add-folder' %}",

                            data: {

                                'csrfmiddlewaretoken': '{{ csrf_token }}',

                                'f': uid,
                                'n': $('.current-note-uid').val(),

                            }
                            
                        });

                        noteFolders.push(uid);

                    }

                });

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == $('.current-note-uid').val()) {

                        if ($(this).children('.folders').length > 0) {

                            $(this).children('.folders').append(

                                `
                                    <div class='folder'>
                                        
                                        <span class='folder-title'>` + title + `</span>

                                    </div>

                                `

                            );

                        } else {

                            $(this).append(`<div class='folders'></div>`);

                            $(this).children('.folders').append(

                                `
                                    <div class='folder'>
                                        
                                        <span class='folder-title'>` + title + `</span>

                                    </div>

                                `

                            );

                        }

                    }

                });

                $('.create-new-folder-from-search-current').hide();
                $('.folder-search').val('');
                $('.folder-search').focus();

                $('.current-note-folders').show();

                $('.folder-list').show();

                folderSearchInit();

            }
    
        });

        /* Close note */

        function closeNote() {

            $('.current-note').animate({'opacity': 0}, 250);
            closeFolderSearch();

            $('#boldBtnCurrent').removeClass('active');
            $('#italicBtnCurrent').removeClass('active');
            $('#underlineBtnCurrent').removeClass('active');
            $('#strikeBtnCurrent').removeClass('active');
            $('#ulBtnCurrent').removeClass('active');
            $('#olBtnCurrent').removeClass('active');

            /* Autosave */

            $.ajax({

                type: 'POST',

                url: "{% url 'app:update-contents' %}",

                data: {

                    'csrfmiddlewaretoken': '{{csrf_token}}',

                    'u': $('.current-note-uid').val(),
                    't': $('.current-note-title').val(),
                    'c': $('.current-note-content').html(),

                }

            });

            noteChanged = false;

            noteUID = $('.current-note-uid').val();

            /* Empty condition */

            if (!$('.current-note-title').val() && !$('.current-note-content').html()) {

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                        $(this).children('.empty').show();

                    }

                });

            } else {

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                        $(this).children('.empty').hide();

                    }

                });

            }

            setTimeout(function() {

                $('.current-note').css('display', 'none');

                $('.current-note-title').val('');
                $('.current-note-content').html('');

                $('#photosCurrent').html('');
                $('#photosCurrent').hide();

                $('.current-note-folders').html('');
            
            }, 250);

            noteOpen = false;

            $('body').css('overflow-y', 'auto');

        }

        $('#closeCurrentNote').click(function() {

            $(this).addClass('active');
            setTimeout(function() {$('#closeCurrentNote').removeClass('active')}, 250);

            closeNote();

        });

    </script>

    <!-- Close forms when ESC has been clicked -->
    <script>

        $('body').click(function(e) {

            if (noteOpen && $(e.target).is('.current-note')) {

                closeNote();

            }

        });

        $('body').keyup(function(e) {

            if (e.keyCode === 27) {

                if (window.opener && window.opener !== window) { /* We're in a pop-up */

                    console.log('p');

                } else {

                    if (folderFormShown) {

                        folderFormShown = false;

                        $('.create-folder').animate({'opacity': 0}, 250);

                        setTimeout(function() {
            
                            $('.create-folder').css('display', 'none');
            
                        }, 250);

                    } else if (accountFormOpen) {

                        $('.account-preferences').animate({

                            'opacity': 0,

                        }, 250);

                        setTimeout(function() {

                            $('#emailError').hide();
                            $('#nameError').hide();
                            $('#passwordError').hide();
                            $('#profilePasswordVal').val('');

                            $('#closeAccountPreferences').removeClass('active');

                            $('.account-preferences').hide();

                        }, 250);

                    } else if (premiumPopUpOpen) {

                        premiumPopUpOpen = false;

                        $('.premium-offer').animate({

                            'opacity': 0,

                        }, 250);

                        setTimeout(function() {

                            $('.premium-offer').hide();

                        }, 250);

                    } else if (editFolderFormShown) {

                        editFolderFormShown = false;

                        $('.edit-folder-btn').removeClass('active');

                        $('.edit-folder').animate({'opacity': 0}, 250);

                        setTimeout(function() {

                            $('.edit-folder').css('display', 'none');

                        }, 250);

                    } else if (noteOpen && !photoOpen && !folderSearchOpen) {

                        closeNote();

                    } else if (folderSearchOpen && !photoOpen) {

                        closeFolderSearch();

                    } else {

                        closePhotoCarousel();
                        photoOpen = false;

                    }

                }

            }

        });

    </script>

    <!-- Notes -->
    <script>

        $('body').on('click', '#cancelSearch', function() {

            $('.notes').animate({'opacity': 0}, 500);
            setTimeout(function() {

                $('.notes').animate({'opacity': 1}, 500);

            });

        });

        /* Note actions @hover */

        $('body').on('mouseover', '.note', function() {

            $(this).children('.note-actions').animate({'opacity': 1}, 250);
            $(this).children('.folders').css('overflow', 'auto');

        });

        $('body').on('mouseleave', '.note', function() {

            $(this).children('.note-actions').animate({'opacity': 0}, 250);
            $(this).children('.folders').css('overflow', 'hidden');

        });

        /* Note actions functionality */

        $('body').on('click', '#loveNote, #pinNote, #archiveNote, #deleteNote', function() {

            $(this).toggleClass('active');

        });

            /* Love */

        $('body').on('click', '#loveNote', function() {

            $.ajax({

                type: 'POST',

                url: "{% url 'app:love-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

            /* Pin */

        $('body').on('click', '#pinNote', function() {

            /* Verify that we're not in the trash */

            if (!($('.note-section-title').text() == 'Корзина')) {

                note = $(this).parent().parent();

                if ($(this).hasClass('active')) { /* pin */

                    if ($('#pinnedNotes').length) {

                        note.insertAfter($('#pinnedNotes').children('.section-title'));

                    } else {

                        $(`<div class="note-section" id="pinnedNotes"><span class="section-title">Закрепленные заметки</span></div>`).insertAfter($('.note-section-title'))

                        note.insertAfter($('#pinnedNotes').children('.section-title'));
                        
                        if ($('#otherNotes').children('.note').length === 0) {

                            $('#otherNotes').remove();
                        
                        }

                    }

                    if ($('#otherNotes').children('.note').length === 0) {

                        $('#otherNotes').remove();

                    }

                    if ($('#otherNotes').children('.note').length > 0 && $('#otherNotes').children('.section-title').length === 0) {

                        $('#otherNotes').prepend(`<span class='section-title'>Другие заметки</span>`);

                    }

                } else { /* unpin */

                    if ($('#otherNotes').length) {

                        note.insertAfter($('#otherNotes').children('.section-title'));

                        if ($('#pinnedNotes').children('.note').length === 0) {
                            
                            $('#otherNotes').children('.section-title').remove();
                        
                        }

                    } else {

                        if ($('#pinnedNotes').children('.note').length === 1) {

                            $('.notes').children('.wrapper').append(

                                `

                                    <div class="note-section" id="otherNotes"></div>

                                `

                            );

                            note.appendTo('#otherNotes');

                        } else {

                            $('.notes').children('.wrapper').append(

                                `

                                    <div class="note-section" id="otherNotes">

                                        <span class="section-title">Другие заметки</span>

                                    </div>

                                `

                            );

                            note.insertAfter($('#otherNotes').children('.section-title'));

                        }

                    }

                    if ($('#pinnedNotes').children('.note').length === 0) {

                        $('#pinnedNotes').remove();

                    }
                
                }

            }

            $.ajax({

                type: 'POST',

                url: "{% url 'app:pin-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

            /* Removing note section logic function */

        function pinLogic(pinned) {

            pinnedEmpty = false;
            otherEmpty = false;

            if (pinned) {

                if ($('#pinnedNotes').children('.note').length === 1) {

                    $('#pinnedNotes').animate({'opacity': 0}, 250);
                    pinnedEmpty = true;

                }

            } else {

                if ($('#otherNotes').children('.note').length === 1) {

                    $('#otherNotes').animate({'opacity': 0}, 250);
                    otherEmpty = true;

                }

            }

        }

            /* Archive */

        $('body').on('click', '#archiveNote', function() {

            /* Verify that the note is not in trash */

            if (!($('.note-section-title').text() == 'Корзина')) {

                note = $(this).parent().parent();
                pinned = $(this).siblings('#pinNote').hasClass('active');

                note.animate({'opacity': 0}, 250);
                
                pinLogic(pinned);

                setTimeout(function() {
                    
                    note.remove();

                    if (pinnedEmpty && !otherEmpty) {

                        $('#pinnedNotes').remove();

                    } else if (!pinnedEmpty && otherEmpty) {

                        $('#otherNotes').remove();

                    }
                
                }, 250);

            }
            
            $.ajax({

                type: 'POST',

                url: "{% url 'app:archive-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

            /* Delete */

        $('body').on('click', '#deleteNote', function() {

            note = $(this).parent().parent();
            pinned = $(this).siblings('#pinNote').hasClass('active');
            
            pinLogic(pinned);

            setTimeout(function() {
                
                note.remove();

                if (pinnedEmpty && !otherEmpty) {

                    $('#pinnedNotes').remove();

                } else if (!pinnedEmpty && otherEmpty) {

                    $('#otherNotes').remove();

                }
            
            }, 250);

            $.ajax({

                type: 'POST',

                url: "{% url 'app:delete-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

            /* If the trash is empty, change the info */

            $('#emptyTrashBtn').remove();
            $('.empty-trash').children('.info').text('Корзина пуста!');

        });

        /* Empty note */

        $('.note').each(function() {

            title = $(this).children('.text').children('.title').text();
            content = $(this).children('.text').children('.content').html();

            uid = $(this).children('.note-actions').children('#noteUID').val();

            if (title === '' && content == '') {

                $(this).children('.empty').show();

            }
                    
        });

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementsByClassName('notes')[0]) {

                $('.note').each(function() {

                    text = $(this).children('.text');

                    title = text.children('.title').text();
                    content = text.children('.content').html();

                    uid = $(this).children('.note-actions').children('#noteUID').val();

                    if (title === '' && content == '') {

                        $(this).children('.empty').show();

                    }

                });

            }
    
        });

    </script>

    <script>

        newLineHTML = `

            <div><br></div>

        `

        $('body').on('keydown', function(e) {

            if (e.keyCode === 9) {

                e.preventDefault();

                if ($('.current-note-content').is(':focus')) {

                    var selection = window.getSelection();
                    var range = selection.getRangeAt(0);
                    var container = range.commonAncestorContainer;
                    var nodeParent = container.parentNode;


                    if (nodeParent.tagName == 'LI') {

                        nodeParent = nodeParent.parentNode;
                        document.execCommand('insertHTML', false, newLineHTML);
                        
                    }

                    if (nodeParent.tagName == 'UL') {

                        if (nodeParent.class == undefined) {
                            
                            document.execCommand('insertHTML', false, newLineHTML);

                        }

                    }

                }

                if (document.activeElement.class == 'current-note-content') {

                    pass;

                }
                
            }

        });

    </script>

    <!-- RTE -->
    <script>

        /* formatting check function */
        function styleCheck() {

            if (document.queryCommandState('bold')) {$('#boldBtnCurrent').addClass('active');} else {$('#boldBtnCurrent').removeClass('active');}
            if (document.queryCommandState('italic')) {$('#italicBtnCurrent').addClass('active');} else {$('#italicBtnCurrent').removeClass('active');}
            if (document.queryCommandState('underline')) {$('#underlineBtnCurrent').addClass('active');} else {$('#underlineBtnCurrent').removeClass('active');}
            if (document.queryCommandState('strikeThrough')) {$('#strikeBtnCurrent').addClass('active');} else {$('#strikeBtnCurrent').removeClass('active');}
            
            if (document.queryCommandState('insertUnorderedList')) {$('#ulBtnCurrent').addClass('active');} else {$('#ulBtnCurrent').removeClass('active');}
            if (document.queryCommandState('insertOrderedList')) {$('#olBtnCurrent').addClass('active');} else {$('#olBtnCurrent').removeClass('active');}

        }

        /* formatting check events */
        $('.current-note-content').keyup(function() {

            styleCheck();

        });

        $('.current-note-content').click(function() {

            styleCheck();

        });

        /* formatting */
        $('#boldBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('bold');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#italicBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('italic');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#underlineBtnCurrent').click(function() {
            
            $('.current-note-content').focus();
            document.execCommand('underline');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#strikeBtnCurrent').click(function() {
            
            $('.current-note-content').focus();
            document.execCommand('strikeThrough');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#ulBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('insertUnorderedList');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#olBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('insertOrderedList');
            $('.current-note-content').focus();
            
            styleCheck();

        });

        /* photo upload */
        $('#photoBtnCurrent').click(function() {

            $(this).addClass('active');
            setTimeout(function() {$('#photoBtnCurrent').removeClass('active')}, 200);

            $('#currentNotePhotoInput').click();

        });

        $('#currentNotePhotoInput').on('change', function() {

            $('#currentNotePhotoSubmit').click();

        });

        /* Remove style from pasted text */
        document.getElementsByClassName('current-note-content')[0].addEventListener('paste', function(e) {

            e.preventDefault();
            var text = e.clipboardData. getData("text/plain");
            document.execCommand("insertHTML", false, text);

        });

    </script>

    <!-- Trash -->

    <script>

        $('body').on('click', '#emptyTrashBtn', function() {

            $(this).addClass('active');

            $('.empty-trash').animate({

                'opacity': 0,

            }, 250);

            $('.note-section').children('.note').each(function() {
                    
                $(this).animate({

                    'opacity': 0,

                }, 250);

            });

            setTimeout(function() {

                $('.note-section').children('.note').each(function() {
                    
                    $(this).remove();

                });
                
                $('#emptyTrashBtn').remove();
                
                $('.empty-trash').children('.info').text('Корзина пуста!');
                $('.empty-trash').animate({

                    'opacity': 1,

                }, 250);

            }, 250)

            $.ajax({

                type: 'POST',

                url: "{% url 'app:empty-trash' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                }

            });

        });

    </script>

</html>